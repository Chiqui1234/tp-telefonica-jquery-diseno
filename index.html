<!DOCTYPE html>
<html lang="es">
    <head>
        <meta charset="UTF-8" />
        <title>Alta de alumnos</title>
        <link rel="stylesheet" href="/assets/css/main.css" />
        <link rel="stylesheet" href="/assets/css/all.min.css" />
        <meta name="viewport" content="initial-scale=1, maximum-scale=1" />
    </head>
<body>
    <main>
        <form>
            <input type="text" id="email" placeholder="E-mail" />
            <input type="text" id="pass" placeholder="Contraseña" />
            <button type="button" id="submit">Iniciar sesión</button>
            <div id="estado"></div> <!-- Estado del login -->
        </form>
    </main>
<script
src="https://code.jquery.com/jquery-3.4.1.min.js"
integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo="
crossorigin="anonymous"></script>
<script>
    function comprobarCaracteresNoPermitidos(email, caracteresNoPermitidos)
    {
        for(let i = 0;i < caracteresNoPermitidos.length;i++)
            return email.charAt(i) == caracteresNoPermitidos[i]?false:true; // Si estoy leyendo un caracter no permitido, devuelvo FALSE
        
        return true; // Si se salió del bucle sin hacer un return previamente, es porque el bucle no encontró ningún caracter malo :)
    }
    function comprobarEmail(email)
    {
        let caracteresNoPermitidos = // Esto me sirve para validar el email. Es un vector que le paso a comprobarCaracteresNoPermitidos()
        [
            '!','#','$','%','^','&','*','(',')','=','[',']','{','}','\'',';',':','='
        ];
        let arroba = 0, puntos = 0, caracteres = 0, lectura;
        for(let i = 0;i < email.length;i++)
        {
            lectura = email.charAt(i);
            if( lectura == '@' )
                arroba++;
            else if(lectura == '.')
                puntos++;
            else
                if( comprobarCaracteresNoPermitidos(email, caracteresNoPermitidos) )
                        caracteres++; // +1 al contador de caracteres
                else // Si hay algún caracter raro, el email es inválido
                    return false;
        }
        return arroba==1&&puntos <= 3&&puntos>=1&&caracteres > 4?true:false;
    }
    function comprobarContrasena(contrasena)
    {
        return contrasena.length>8?true:false;
    }
    function comprobarLogin(datos)
    {
        let estadoSesion = {
            emailOk: false,
            contrasenaOk: false,
            clase: 'false' // .error u .ok debe ser activada
        };
        estadoSesion.emailOk = comprobarEmail(datos.email);
        estadoSesion.contrasenaOk = comprobarContrasena(datos.contrasena);
        if( estadoSesion.emailOk && estadoSesion.contrasenaOk )
            estadoSesion.clase = 'ok';
        else
            estadoSesion.clase = 'error';
        
        console.log('En la función: ');
        console.log(estadoSesion);
        return estadoSesion;
    }

$(document).ready(function() {
    $('#submit').click(function() {
        let datos = 
        {
            email: $('#email').val(), 
            contrasena: $('#pass').val()
        };
        let estadoSesion = comprobarLogin(datos); // emailOk, contrasenaOk, clase
        console.log('En la vista: ');
        console.log(estadoSesion);
        $('#estado').html(''); // Sobre-escribo el contenido de la etiqueta
        $('#estado').addClass(estadoSesion.clase+' padding margin-top');
        $('#estado').append(`Email dio ${estadoSesion.clase}. `);
        $('#estado').append(`Contraseña dio ${estadoSesion.clase}. `);    
    });
});
</script>
</body>
</html>